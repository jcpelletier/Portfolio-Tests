name: Smoke Test

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * *'  # Every day at 12:00 UTC

jobs:
  run-smoketest:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ðŸ“¦ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ðŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install playwright
          python -m playwright install

      - name: ðŸ§ª Confirm Home Page Loads
        run: python Tests/test_page_loads.py
        env:
          SMOKETEST_URL: "https://www.jpelletier.com"

      - name: ðŸ§ª Confirm Professional Projects Page Loads
        run: python Tests/test_page_loads.py
        env:
          SMOKETEST_URL: "https://www.jpelletier.com/professional-projects"

      - name: ðŸ§ª Confirm Side Projects Page Loads
        run: python Tests/test_page_loads.py
        env:
          SMOKETEST_URL: "https://www.jpelletier.com/side-projects"
          TEST_SELECTOR: "text=Disruptor Beam - Star Trek Timelines"

      - name: ðŸ§ª Confirm Home Page Contains Name
        run: python Tests/test_text_presence.py
        env:
          SMOKETEST_URL: "https://www.jpelletier.com"
          EXPECTED_TEXT: "Joel Pelletier"

      - name: ðŸ“¤ Upload screenshot artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: smoketest-screenshots
          path: '**/*.png'
